<!doctype html>
<html lang="en" data-bs-theme="auto">
  <head>

    <meta charset="utf-8">
    

    <title>Monitorio</title>

  
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="css/dashboard.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  </head>

  <body>

    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
            
        <symbol id="file-earmark" viewBox="0 0 16 16">
          <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
        </symbol>

        <symbol id="house-fill" viewBox="0 0 16 16">
          <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z"/>
          <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z"/>
        </symbol>

    </svg>

      <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white">Interforest</a>
      

      
        <div id="navbarSearch" class="navbar-search w-100 collapse">
          <input class="form-control w-100 rounded-0 border-0" type="text" placeholder="Search" aria-label="Search">
        </div>

        <div class="navbar-nav">
          <div class="nav-item text-nowrap">
            <a type="button" class="px-3 btn btn-danger" href="logout">Logout</a>
          </div>
        </div>
      </header>

<div class="container-fluid">
  <div class="row">
    <div class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary">
      <div class="offcanvas-md offcanvas-end bg-body-tertiary" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="sidebarMenuLabel">Interforest</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Close"></button>
        </div>
        
        <div class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3 overflow-y-auto">
          <ul class="nav flex-column extend-sidebar">
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center gap-2 active" aria-current="page" href="/">
                <svg class="bi"><use xlink:href="#house-fill"/></svg>
                MONITOREO
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center gap-2" href="/register">
                <svg class="bi"><use xlink:href="#file-earmark"/></svg>
                Nueva Operacion
              </a>
            </li>
          </ul>
        </div>

      </div>
    </div>


    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <h1 class="h2">MONITOREO</h1>
      
        <div style="display: inline-block; margin-left: 200px; ">

          <table class="table" style="width:auto">
            <thead class="table-light" align="center">
              <tr>
                <th>Cliente</th>
                <th>Telefono</th>
                <th>Correo</th>
                <th>Pedido</th>
                <th>Estatus</th>
              </tr>
            </thead>
            <tbody>
              <% results.forEach(function(result) { %>
                <tr>
                    <td><%= result.nom_Cliente %></td>
                    <td><%= result.telefono %></td>
                    <td><%= result.correo %></td>
                    <td><%= result.pedido %></td>
                    <td><%= result.estatus %></td>
                </tr>
            <% }); %>
            </tbody>
          </table>
        </div>
        
        
      <div style="display: block; margin-left: 30px;">

        <table class="table " style="width:auto">
          <thead class="table-light" align="center">
            <tr>
              <th>Pedido</th>
              <th>Corte</th>
              <th>Enchape</th>
              <th>Embalaje</th>
              <th>GA</th>
              <th>Fecha</th>
              <th>Destino</th>
              <th>F.entrega</th>
              <th>Estatus</th>
              <th>Cliente</th>
              <th>Acciones</th>
            </tr>
          </thead>

          <tbody>
            <form id="datos-tabla" method="post">
              <% results.forEach(function(result) { %>
                <tr align="center">
                    <td id="pedidoCelda"><%= result.pedido %></td>
                    <td id="corteEditable" class="celda-editable" data-original-value="<%= result.CORTE %>" >
                      <select class="select-editable" disabled>
                        <option id="valorInicialCorte" data-value="<%= result.CORTE %>" selected><%= result.CORTE === 1 ? 'SI' : 'NO' %></option>
                        <option id="optOpuesto" data-value="<%= result.CORTE === 1 ? 0 : 1 %>"><%= result.CORTE === 1 ? 'NO' : 'SI' %></option>
                      </select>
                    </td>
                    <td id="enchapeEditable" class="celda-editable" data-original-value="<%= result.ENCHAPE %>" >
                      <select  class="select-editable" disabled>
                        <option id="valorInicialEnchape" data-value="<%= result.ENCHAPE %>" selected><%= result.ENCHAPE == 1 ? 'SI' : 'NO' %></option>
                        <option id="optOpuesto" data-value="<%= result.ENCHAPE === 1 ? 0 : 1 %>"><%= result.ENCHAPE === 1 ? 'NO' : 'SI' %></option>
                      </select>
                    </td>
                    <td id="embalajeEditable" class="celda-editable" data-original-value="<%= result.EMBALAJE%>" >
                      <select  class="select-editable" disabled>
                        <option id="valorInicialEmbalaje" data-value="<%= result.EMBALAJE %>" selected><%= result.EMBALAJE == 1 ? 'SI' : 'NO' %></option>
                        <option id="optOpuesto" data-value="<%= result.EMBALAJE === 1 ? 0 : 1 %>"><%= result.EMBALAJE === 1 ? 'NO' : 'SI' %></option>
                      </select>
                    </td>
                    <td ><%= result.GA %></td>
                    <td ><%= result.fecha_Inicio %></td>
                    <td ><%= result.lugar_Destino %></td>
                    <td ><%= result.fecha_Entrega %></td>
                    <td id="estatusEditable" class="celda-editable" data-original-value="<%= result.estatus %>">
                    <select class="select-editable" disabled>
                      <option id="valorInicialEstatus" data-value="<%= result.estatus %>" selected><%= result.estatus %></option>
                      <option data-value="Emplayado">Emplayado</option>
                      <option data-value="Enviado">Enviado</option>
                    </select>
                    </td>
                    <td ><%= result.nom_Cliente %></td>
                    <td>
                      <a class="btn edit-btn">Editar</a>

                      <a class="btn save-btn " href="/" style="display:none;" >Guardar</a>
                      <a class="btn cancel-btn" style="display:none;">Cancelar</a>
                      <a class="btn view-btn" href="/view">Ver</a>
                      <a class="btn delete-btn">Borrar</a>
                    </td>
                </tr>
            <% }); %>
            </form>
          </tbody>
        </table>
      </div>
    </main>
  </div>
</div>

    <!--Mensajes Alert-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!--Mostrar Botones de Editar-->
    <script type="text/javascript" language="javascript" src="js/mostrarBotones.js"></script>

    <!--Guardar Cambios-->
    <script type="text/javascript" language="javascript" src="js/saveEdit.js"></script>

    <!--Cancelar Editar-->
    <script type="text/javascript" language="javascript" src="js/cancelEdit.js"></script>

    <!--Borrar Pedido -->
    <script type="text/javascript" language="javascript" src="js/delete.js"></script>

    <!--Ver Pedido-->
    <script>
      const view = document.querySelectorAll('.view-btn')
    
      view.forEach(function(ver){
        ver.addEventListener('click', function(){
          const row = this.parentElement.parentElement;
          const pedido = row.querySelector('#pedidoCelda').innerText;
    
    
          const idPedido = pedido;
          const url = `/view?idPedido=${idPedido}`;
    
          fetch(url)
          .then(response => {
            if (response.ok) {
              // La solicitud fue exitosa
              
              return response.json();
            } else {
              throw new Error('Error en la solicitud.');
            }
          })
          .then(data => {
            // Manejar la respuesta JSON
            console.log(data);
          })
          .catch(error => {
            // Manejar errores
            console.error(error);
          });
        });
      });
    </script>
    
    
  </body>
</html>